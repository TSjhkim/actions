name: Deploy SQL to MSSQL
 
on:
  push:
    paths:
      - '**/*.sql'  # SQL 파일이 수정될 때만 실행
 
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
    - name: Deploy SQL to MSSQL
      env:
        MSSQL_HOST: ${{ secrets.MSSQL_HOST }}
        MSSQL_USER: ${{ secrets.MSSQL_USER }}
        MSSQL_PASSWORD: ${{ secrets.MSSQL_PASSWORD }}
      run: |
        # SQL 파일 배포 스크립트 실행
        # PowerShell 스크립트를 사용하여 SQL 파일 실행
        $sqlFiles = Get-ChildItem -Path . -Filter "*.sql" -Recurse
        foreach ($file in $sqlFiles) {
          sqlcmd -S $env:MSSQL_HOST -U $env:MSSQL_USER -P $env:MSSQL_PASSWORD -i $file.FullName
        }
